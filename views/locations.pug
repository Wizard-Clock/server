extends layout

block content
    div(class="row justify-content-center")
        div(class="col-auto w-75")
            div()
                h1(class="pb-2 mb-4 border-bottom") Location Management
                table(class="table table-striped table-hover")
                    thead()
                        tr()
                            th(scope="col") ID
                            th(scope="col") Clock Position
                            th(scope="col") Name
                            th(scope="col") Longitude
                            th(scope="col") Latitude
                            th(scope="col") Radius (ft)
                            th(scope="col") Description
                            th(scope="col") Edit
                            th(scope="col") Delete
                            th(scope="col") Preview
                    tbody()
                         each location in locations
                             tr()
                                 th(scope="row" id="location-id")= location.id
                                 if location.clockPosition
                                    td()= location.clockPosition
                                 else
                                    td() NA
                                 td()= location.name
                                 td()= location.longitude
                                 td()= location.latitude
                                 td()= location.radius
                                 td()= location.description
                                 td()
                                     button(type="button" class="btn btn-light" data-bs-toggle="modal" data-bs-target="#editLocationModal" data-bs-location= location)
                                         i(class="bi bi-pencil-square")
                                 td()
                                     button(type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteLocatioModal" data-bs-location= location)
                                         i(class="bi bi-trash3-fill")
                                 td()
                                     button(type="button" class="btn btn-primary"  onclick="previewLocation()" data-bs-location= location)
                                         i(class="bi bi-eye-fill")
                button(type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addLocationModal") Add Location&nbsp;
                    i(class="bi bi-geo-alt")
            div()
                h1(class="pb-2 mb-4 border-bottom") Location Preview
                div(id="map")

            div(class="modal fade" id="addLocationModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="addLocationModalLabel" aria-hidden="true")
                div(class="modal-dialog modal-dialog-centered")
                    div(class="modal-content")
                        div(class="modal-header")
                            h1(class="modal-title fs-5" id="addLocationModalLabel") Add User
                            button(type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close")
                        div(class="modal-body")
                            form(class="row g-3" id="addLocationForm")
                                div(class="col-md-8")
                                    section()
                                        label(for="locationNameAddInput" class="form-label") Name
                                        input(type="text" class="form-control" name="name" id="locationNameInput" required)
                                div(class="col-md-4")
                                    section()
                                        label(for="clockPosSelectInput" class="form-label") Clock Position
                                        select(id="clockPosSelectInput" class="form-select" name="clockPos")
                                            option(selected disabled value="") Choose...
                                            for position in positions
                                                if position.location_id
                                                else
                                                    option()=position.position
                                div(class="col-md-4")
                                    section()
                                        label(for="latitudeAdd" class="form-label") Latitude&nbsp;
                                            i(class="bi bi-question-circle-fill" data-bs-toggle="tooltip" data-bs-title="Must be a valid number between -90 and 90, and 0.0 formatting should followed.")
                                        input(type="text" class="form-control" name="latitude" id="latitudeAdd" pattern="^(\\+|-)?(?:90(?:(?:\\.0{1,6})?)|(?:[0-9]|[1-8][0-9])(?:(?:\\.[0-9]{1,6})?))$" required)
                                div(class="col-md-4")
                                    section()
                                        label(for="longitudeAdd" class="form-label") Longitude&nbsp;
                                            i(class="bi bi-question-circle-fill" data-bs-toggle="tooltip" data-bs-title="Must be a valid number between -180 and 180, and 0.0 formatting should followed.")
                                        input(type="text" class="form-control" name="longitude" id="longitudeAdd" pattern="^(\\+|-)?(?:180(?:(?:\\.0{1,6})?)|(?:[0-9]|[1-9][0-9]|1[0-7][0-9])(?:(?:\\.[0-9]{1,6})?))$" required)
                                div(class="col-md-4")
                                    section()
                                        label(for="radiusAdd" class="form-label") Radius (ft)
                                        input(type="number" min=0 class="form-control" name="radius" id="radiusAdd" required)
                                div(class="col-md-12")
                                    section()
                                        label(for="descriptionAdd" class="form-label") Description
                                        textarea(class="form-control" name="description" id="descriptionAdd")
                                div(class="col-12")
                                    button(type="submit" class="btn btn-primary") Add Location
                        div(class="modal-footer")
                            button(type="button" class="btn btn-secondary" data-bs-dismiss="modal") Cancel
            script.
                document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(tooltip => {
                    new bootstrap.Tooltip(tooltip);
                })

                var map = L.map('map').setView([41.737023, -99.587382], 5);
                L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                }).addTo(map);
